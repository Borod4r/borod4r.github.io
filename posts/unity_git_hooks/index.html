<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Unity and convenience of Git hooks" />
<meta name="author" content="Borodar" />
<meta property="og:locale" content="en" />
<meta name="description" content="Diving into a large project with a horde of developers without a solid workflow is like trying to herd cats. Entertaining but not particularly productive. But even the best workflows are affected by human factors. People make mistakes, forget things, and sometimes just don’t care. That’s why having a plan B is pretty darn handy." />
<meta property="og:description" content="Diving into a large project with a horde of developers without a solid workflow is like trying to herd cats. Entertaining but not particularly productive. But even the best workflows are affected by human factors. People make mistakes, forget things, and sometimes just don’t care. That’s why having a plan B is pretty darn handy." />
<link rel="canonical" href="https://blog.borodar.com/posts/unity_git_hooks/" />
<meta property="og:url" content="https://blog.borodar.com/posts/unity_git_hooks/" />
<meta property="og:site_name" content="Borodar’s Blog" />
<meta property="og:image" content="/assets/img/posts/2024/2024-01-24-unity_git_hooks.webp" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-01-24T17:32:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/assets/img/posts/2024/2024-01-24-unity_git_hooks.webp" />
<meta property="twitter:title" content="Unity and convenience of Git hooks" />
<meta name="twitter:site" content="@borodargames" />
<meta name="twitter:creator" content="@borodargames" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Borodar","url":"https://www.borodar.com/"},"dateModified":"2024-01-24T17:32:00+02:00","datePublished":"2024-01-24T17:32:00+02:00","description":"Diving into a large project with a horde of developers without a solid workflow is like trying to herd cats. Entertaining but not particularly productive. But even the best workflows are affected by human factors. People make mistakes, forget things, and sometimes just don’t care. That’s why having a plan B is pretty darn handy.","headline":"Unity and convenience of Git hooks","image":"/assets/img/posts/2024/2024-01-24-unity_git_hooks.webp","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.borodar.com/posts/unity_git_hooks/"},"url":"https://blog.borodar.com/posts/unity_git_hooks/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Unity and convenience of Git hooks | Borodar's Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Borodar's Blog">
<meta name="application-name" content="Borodar's Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar (modified v6.4.2) -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/global/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">Borodar's Blog</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">About making games, assets, and other kinds of magic</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">

    
      

      
        <a
          href="https://twitter.com/borodargames"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="https://www.facebook.com/borodargames"
          aria-label="facebook"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-facebook"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['contact','borodar.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    

    
    <button type="button" class="mode-toggle btn" aria-label="Switch Mode">
      <i class="fas fa-adjust"></i>
    </button>
    

  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->

    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Unity and convenience of Git hooks</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Unity and convenience of Git hooks</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1706110320"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jan 24, 2024
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/posts/2024/2024-01-24-unity_git_hooks.webp" class="popup img-link preview-img shimmer"><img src="/assets/img/posts/2024/2024-01-24-unity_git_hooks.webp"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              
                <a href="https://www.borodar.com/">Borodar</a>
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2322 words"
>
  <em>12 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <p>Diving into a large project with a horde of developers without a solid workflow is like trying to herd cats. Entertaining but not particularly productive. But even the best workflows are affected by human factors. People make mistakes, forget things, and sometimes just don’t care. That’s why having a plan B is pretty darn handy.</p>

<p>Once upon a time, on a relatively large project, we constantly had an issue with accidental commits that messed with our project settings. It was like deja vu, having to reverse these changes and then play the nagging parent, explaining why it’s a no-no. Over and over again. That’s when I had my lightbulb moment: why not stop these commits before they even happen?</p>

<p>From those times, I’m a big fan of Git Hooks. So, let me share how they helped us in this particular case. And how to handle them conveniently in Unity.</p>

<h2 id="what-are-git-hooks"><span class="me-2">What are <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">Git hooks</a></span><a href="#what-are-git-hooks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Git hooks are scripts that Git executes before or after events such as: commit, push, and receive. They are stored in the <code class="language-plaintext filepath highlighter-rouge">.git/hooks</code> directory of your project. You can use them to automate tasks, enforce best practices, and prevent bad commits.</p>

<p>Worth to mention that there are two types of hooks: client-side and server-side. Client-side hooks are triggered on your local machine, and server-side hooks are triggered on the remote repository. In this article, we’ll focus on client-side hooks.</p>

<h2 id="how-to-use-git-hooks"><span class="me-2">How to use Git hooks</span><a href="#how-to-use-git-hooks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Git hooks are just regular scripts. The only requirement is that they should be executable. Picking a language for a Git hook is like choosing ice cream flavors – there’s no wrong choice. But I went with Bash, because sometimes, classic vanilla is just what you need. It’s simple, powerful, and available on all platforms. If you have Git installed, you already have Bash.</p>

<p>There are a lot of client-side hooks. You can find the complete list <a href="https://git-scm.com/docs/githooks">here</a>. In this article, we’ll focus on the <code class="language-plaintext highlighter-rouge">pre-commit</code> hook. It’s triggered before each commit and is a perfect place to check if the commit is valid. Exactly what we need to prevent accidental file modifications! However, you can extend our approach to any other hook if you need to.</p>

<p>So, let’s create a <code class="language-plaintext highlighter-rouge">pre-commit</code> hook. To do that, we must create a file named exactly as the hook we want to use. With no extension.</p>

<div file=".git/hooks/pre-commit" class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text=".git/hooks/pre-commit"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/sh</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then, we need to put it in the <code class="language-plaintext filepath highlighter-rouge">.git/hooks</code> directory of our project. And make it executable. That’s it! Now, each time you commit something, Git will execute this script.</p>

<h2 id="how-to-check-if-the-commit-is-valid"><span class="me-2">How to check if the commit is valid</span><a href="#how-to-check-if-the-commit-is-valid" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Now, our hook formally works. It’s triggered before each commit, but it doesn’t do anything. Let’s change that and prevent any commit that modifies the Unity project settings file.</p>

<p>At first, let’s verify that our <code class="language-plaintext highlighter-rouge">HEAD</code> exists. It’s a reference to the last commit in the current branch. If it doesn’t exist, it means that we’re committing for the first time. In this case, we will use a special empty tree object as a reference. It’s always there, so we can use it as a reference for the initial commit. We’ll need this reference later.</p>

<div class="language-sh nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="k">if </span>git rev-parse <span class="nt">--verify</span> HEAD <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
<span class="k">then
  </span><span class="nv">against</span><span class="o">=</span>HEAD
<span class="k">else</span>
  <span class="c"># Initial commit: diff against an empty tree object</span>
  <span class="nv">against</span><span class="o">=</span>4b825dc642cb6eb9a060e54bf8d69288fbee4904
<span class="k">fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then, let’s redirect the output to <code class="language-plaintext highlighter-rouge">stderr</code>. It’s not required, but it’s a good practice. It will help you to debug your hooks if something goes wrong.</p>

<div class="language-sh nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">exec </span>1&gt;&amp;2
</pre></td></tr></tbody></table></code></div></div>

<p>Now, we can check if the commit contains changes to the files that must not change. To do that, we’ll use the <code class="language-plaintext highlighter-rouge">git diff</code> command. It compares two commits and outputs the list of files that were changed. We’ll use our <code class="language-plaintext highlighter-rouge">against</code> variable as the first commit and the <code class="language-plaintext highlighter-rouge">--cached</code> flag to compare it with the staged changes.</p>

<p>Then, we’ll pipe the output to the <code class="language-plaintext highlighter-rouge">grep</code> command. It will search for the files that must not change. If it finds any, it will output them to <code class="language-plaintext highlighter-rouge">stdout</code>. If it doesn’t find any, it will output nothing. Then, we’ll use the <code class="language-plaintext highlighter-rouge">--quiet</code> flag to suppress the output. And <code class="language-plaintext highlighter-rouge">--line-regexp</code> and <code class="language-plaintext highlighter-rouge">--fixed-strings</code> flags to ensure we’re searching for the exact file names.</p>

<p>Finally, we’ll use the <code class="language-plaintext highlighter-rouge">--file</code> flag to pass a file to search for.</p>

<p>And the <code class="language-plaintext highlighter-rouge">exit</code> command to exit the script with the appropriate exit code.</p>

<div class="language-sh nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">if </span>git diff <span class="nt">--cached</span> <span class="nt">--name-only</span> <span class="nv">$against</span> |
   <span class="nb">grep</span> <span class="nt">--quiet</span> <span class="nt">--line-regexp</span> <span class="nt">--fixed-strings</span> <span class="s2">"ProjectSettings/ProjectSettings.asset"</span>
<span class="k">then
  </span><span class="nb">echo </span>Commit would modify one or more files that must not change.
  <span class="nb">exit </span>1
<span class="k">else
  </span><span class="nb">exit </span>0
<span class="k">fi</span>
</pre></td></tr></tbody></table></code></div></div>

<p>If needed, we could improve that snippet by checking for a list of files at once. Let’s introduce the <code class="language-plaintext highlighter-rouge">MUST_NOT_CHANGE</code> variable for those purposes. Paths should be relative to the repo root and separated by newlines.</p>

<div class="language-sh nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="nv">MUST_NOT_CHANGE</span><span class="o">=</span><span class="s1">'
ProjectSettings/ProjectSettings.asset
Assets/Resources/I2Languages.asset
'</span>

<span class="k">if </span>git diff <span class="nt">--cached</span> <span class="nt">--name-only</span> <span class="nv">$against</span> |
   <span class="nb">grep</span> <span class="nt">--quiet</span> <span class="nt">--line-regexp</span> <span class="nt">--fixed-strings</span> <span class="s2">"</span><span class="nv">$MUST_NOT_CHANGE</span><span class="s2">"</span>
<span class="k">then
  </span><span class="nb">echo </span>Commit would modify one or more files that must not change.
  <span class="nb">exit </span>1
<span class="k">else
  </span><span class="nb">exit </span>0
<span class="k">fi</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="full-example-of-the-pre-commit-hook"><span class="me-2">Full example of the <code class="language-plaintext highlighter-rouge">pre-commit</code> hook</span><a href="#full-example-of-the-pre-commit-hook" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Let’s put all of the above together. Here is the full example of the <code class="language-plaintext highlighter-rouge">pre-commit</code> hook that prevents accidental modifications of the Unity project settings file (or any other files you want).</p>

<div file=".git/hooks/pre-commit" class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text=".git/hooks/pre-commit"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre><span class="c">#!/bin/sh</span>
<span class="c">#</span>
<span class="c"># An example hook script to verify what is about to be committed.</span>
<span class="c"># Called by "git commit" with no arguments. The hook should</span>
<span class="c"># exit with non-zero status after issuing an appropriate message if</span>
<span class="c"># it wants to stop the commit.</span>

<span class="c"># List of files that should not be modified</span>
<span class="c"># Full paths from the repo root separated by newlines</span>
<span class="nv">MUST_NOT_CHANGE</span><span class="o">=</span><span class="s1">'
ProjectSettings/ProjectSettings.asset
Assets/Resources/I2Languages.asset
'</span>

<span class="c"># Get the last commit reference</span>
<span class="k">if </span>git rev-parse <span class="nt">--verify</span> HEAD <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
<span class="k">then
  </span><span class="nv">against</span><span class="o">=</span>HEAD
<span class="k">else</span>
  <span class="c"># Initial commit: diff against an empty tree object</span>
  <span class="nv">against</span><span class="o">=</span>4b825dc642cb6eb9a060e54bf8d69288fbee4904
<span class="k">fi</span>

<span class="c"># Redirect output to stderr</span>
<span class="nb">exec </span>1&gt;&amp;2

<span class="c"># Check if the commit contains changes to the files that must not change.</span>
<span class="k">if </span>git diff <span class="nt">--cached</span> <span class="nt">--name-only</span> <span class="nv">$against</span> |
   <span class="nb">grep</span> <span class="nt">--quiet</span> <span class="nt">--line-regexp</span> <span class="nt">--fixed-strings</span> <span class="s2">"</span><span class="nv">$MUST_NOT_CHANGE</span><span class="s2">"</span>
<span class="k">then</span>
  <span class="c"># Block the commit</span>
  <span class="nb">echo </span>Commit would modify one or more files that must not change.
  <span class="nb">exit </span>1
<span class="k">else</span>
  <span class="c"># Accept the commit</span>
  <span class="nb">exit </span>0
<span class="k">fi</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="how-to-handle-git-hooks-in-unity"><span class="me-2">How to handle Git hooks in Unity</span><a href="#how-to-handle-git-hooks-in-unity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Now, we have a working <code class="language-plaintext highlighter-rouge">pre-commit</code> hook, which does the job and prevents modification for specified files. But it’s not very convenient for each team member to manually copy it to <code class="language-plaintext filepath highlighter-rouge">.git/hooks</code> directory. And it’s not very convenient to update it across the team if we need to change something.</p>

<p>As a result, we just replaced one human factor with another. Like replacing a lost left sock with a right one - it’s a change, but we’re still not quite on the right foot! Not exactly what we are trying to achieve, huh? So let’s automate it then!</p>

<h3 id="git-hooks-registrator"><span class="me-2">Git hooks registrator</span><a href="#git-hooks-registrator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>For those purposes, we’ll create a Unity editor script that automatically registers the <code class="language-plaintext highlighter-rouge">pre-commit</code> hook.</p>

<div file="Assets/Scripts/Editor/GitHooksRegistrator.cs" class="language-csharp highlighter-rouge"><div class="code-header">
        <span data-label-text="Assets/Scripts/Editor/GitHooksRegistrator.cs"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">namespace</span> <span class="nn">EditorTools</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">GitHooksRegistrator</span>
    <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Let’s add the <code class="language-plaintext highlighter-rouge">[InitializeOnLoad]</code> attribute now. It will ensure that the class is initialized when Unity editor is loaded. And add the <code class="language-plaintext highlighter-rouge">static</code> constructor. It will be called when the class is initialized, and it’s a perfect place to register the hook. Because it will be triggered each time you open the project.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="n">InitializeOnLoad</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GitHooksRegistrator</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="nf">GitHooksRegistrator</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">RegisterPreCommitHook</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Now, let’s add constants for the path to the <code class="language-plaintext highlighter-rouge">pre-commit</code> hook and its template. Both should be relative to the repo root.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_PATH</span> <span class="p">=</span> <span class="s">".git/hooks/pre-commit"</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_TEMPLATE_PATH</span> <span class="p">=</span> <span class="s">"Assets/Scripts/Editor/Hooks/pre-commit"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then, let’s actually implement the <code class="language-plaintext highlighter-rouge">RegisterPreCommitHook</code> method. We’ll use the <code class="language-plaintext highlighter-rouge">Application.dataPath</code> variable to get the path to the <code class="language-plaintext filepath highlighter-rouge">Assets</code> directory. And the <code class="language-plaintext highlighter-rouge">FileUtil.ReplaceFile</code> method to copy the template to the hook path.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterPreCommitHook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">PRE_COMMIT_TEMPLATE_PATH</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="s">"Pre-commit template not found."</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="n">FileUtil</span><span class="p">.</span><span class="nf">ReplaceFile</span><span class="p">(</span><span class="n">PRE_COMMIT_TEMPLATE_PATH</span><span class="p">,</span> <span class="n">PRE_COMMIT_PATH</span><span class="p">);</span>
        
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Successfully registered git pre-commit hook"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Failed to register git pre-commit hook with error: </span><span class="p">{</span><span class="n">e</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="registrator-qol-improvements"><span class="me-2">Registrator QoL improvements</span><a href="#registrator-qol-improvements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Auto-registration should work now. But I would like to add a few “quality of life” improvements. First, let’s add a menu item to register the hook manually. It would be helpful if you need to re-register the hook after you changed something in the template.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Tools/Git/Pre-commit/Register hook"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterPreCommitHook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Also, your team members may have their own private hooks already. I bet they’ll not be happy if we’ll silently overwrite it. So, let’s add a backup for the previous hook.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_BAK_PATH</span> <span class="p">=</span> <span class="n">PRE_COMMIT_PATH</span> <span class="p">+</span> <span class="s">".bak"</span><span class="p">;</span>

<span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Tools/Git/Pre-commit/Register hook"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterPreCommitHook</span><span class="p">()</span>
<span class="p">{</span>
        <span class="p">...</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">PRE_COMMIT_PATH</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">FileUtil</span><span class="p">.</span><span class="nf">ReplaceFile</span><span class="p">(</span><span class="n">PRE_COMMIT_PATH</span><span class="p">,</span> <span class="n">PRE_COMMIT_BAK_PATH</span><span class="p">);</span>
            <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Previous pre-commit hook found. Backup created."</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="n">FileUtil</span><span class="p">.</span><span class="nf">ReplaceFile</span><span class="p">(</span><span class="n">PRE_COMMIT_TEMPLATE_PATH</span><span class="p">,</span> <span class="n">PRE_COMMIT_PATH</span><span class="p">);</span>
        
        <span class="p">...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="registrator-versioning"><span class="me-2">Registrator versioning</span><a href="#registrator-versioning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>And finally, let’s use a versioning for the hook. With proper versioning, we could avoid re-registering the hook each time we open the project. Also, this will guarantee that the hook will be re-registered for all team members if we change something in the template.</p>

<p>We’ll use <code class="language-plaintext highlighter-rouge">EditorPrefs</code> for that. First, let’s add a constant for the version key. It should be unique for each project, so let’s use the <code class="language-plaintext highlighter-rouge">Application.dataPath</code> variable as a prefix here. And the <code class="language-plaintext highlighter-rouge">Base64Encode</code> method to avoid issues with special characters.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">;</span>

<span class="k">static</span> <span class="nf">GitHooksRegistrator</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">PRE_COMMIT_PREF_KEY</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="nf">Base64Encode</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">dataPath</span><span class="p">)}</span><span class="s">.git_hook_pre_commit"</span><span class="p">;</span>
    
    <span class="p">...</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">Base64Encode</span><span class="p">(</span><span class="kt">string</span> <span class="n">plainText</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">plainTextBytes</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">plainText</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">plainTextBytes</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Then, let’s add the <code class="language-plaintext highlighter-rouge">int</code> constant for the current version. If you need to re-register the hook, just increment it. Now, our registrator will compare the current version with the installed one (saved in <code class="language-plaintext highlighter-rouge">EditorPrefs</code>), and re-register the hook if needed.</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">PRE_COMMIT_VERSION</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">;</span>

<span class="k">static</span> <span class="nf">GitHooksRegistrator</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">PRE_COMMIT_PREF_KEY</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="nf">Base64Encode</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">dataPath</span><span class="p">)}</span><span class="s">.git_hook_pre_commit"</span><span class="p">;</span>
    
    <span class="kt">var</span> <span class="n">installedVersionKey</span> <span class="p">=</span> <span class="n">EditorPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">installedVersionKey</span> <span class="p">&lt;</span> <span class="n">PRE_COMMIT_VERSION</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nf">RegisterPreCommitHook</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="disabling-the-hook"><span class="me-2">Disabling the hook</span><a href="#disabling-the-hook" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Now, we excluded the possibility of accidental modifications of the project settings file. But what if you need to modify it intentionally? Let’s add a menu item to disable the hook temporarily.</p>

<p>For that purpose, we’ll just delete the hook file. And set the version to <code class="language-plaintext highlighter-rouge">0</code>. It will force the registrator to re-register the hook next time you open the project. More than enough time to make your changes!</p>

<div class="language-csharp nolineno highlighter-rouge"><div class="code-header">
        <span data-label-text="C#"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Tools/Git/Pre-commit/Disable till next run"</span><span class="p">)]</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">DisablePreCommitHook</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">FileUtil</span><span class="p">.</span><span class="nf">DeleteFileOrDirectory</span><span class="p">(</span><span class="n">PRE_COMMIT_PATH</span><span class="p">);</span>
        <span class="n">EditorPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Disabled git pre-commit hook until next run"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Fail to disable git pre-commit hook with error: </span><span class="p">{</span><span class="n">e</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="final-version-of-the-registrator"><span class="me-2">Final version of the registrator</span><a href="#final-version-of-the-registrator" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Now, let’s put all of the above together. Here is the final version of the registrator.</p>

<div file="Assets/Scripts/Editor/GitHooksRegistrator.cs" class="language-csharp highlighter-rouge"><div class="code-header">
        <span data-label-text="Assets/Scripts/Editor/GitHooksRegistrator.cs"><i class="far fa-file-code fa-fw"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
</pre></td><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEditor</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">EditorTools</span>
<span class="p">{</span>
    <span class="p">[</span><span class="n">InitializeOnLoad</span><span class="p">]</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">GitHooksRegistrator</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">PRE_COMMIT_VERSION</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_PATH</span> <span class="p">=</span> <span class="s">".git/hooks/pre-commit"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_BAK_PATH</span> <span class="p">=</span> <span class="n">PRE_COMMIT_PATH</span> <span class="p">+</span> <span class="s">".bak"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_TEMPLATE_PATH</span> <span class="p">=</span> <span class="s">"Assets/Scripts/Editor/Hooks/pre-commit"</span><span class="p">;</span>

        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">;</span>

        <span class="c1">//---------------------------------------------------------------------</span>
        <span class="c1">// Ctors</span>
        <span class="c1">//---------------------------------------------------------------------</span>

        <span class="k">static</span> <span class="nf">GitHooksRegistrator</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">PRE_COMMIT_PREF_KEY</span> <span class="p">=</span> <span class="s">$"</span><span class="p">{</span><span class="nf">Base64Encode</span><span class="p">(</span><span class="n">Application</span><span class="p">.</span><span class="n">dataPath</span><span class="p">)}</span><span class="s">.git_hook_pre_commit"</span><span class="p">;</span>
            
            <span class="kt">var</span> <span class="n">installedVersionKey</span> <span class="p">=</span> <span class="n">EditorPrefs</span><span class="p">.</span><span class="nf">GetInt</span><span class="p">(</span><span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">installedVersionKey</span> <span class="p">&lt;</span> <span class="n">PRE_COMMIT_VERSION</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nf">RegisterPreCommitHook</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">//---------------------------------------------------------------------</span>
        <span class="c1">// Menu</span>
        <span class="c1">//---------------------------------------------------------------------</span>

        <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Tools/Git/Pre-commit/Register hook"</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">RegisterPreCommitHook</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">PRE_COMMIT_TEMPLATE_PATH</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">Debug</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="s">"Pre-commit template not found."</span><span class="p">);</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">PRE_COMMIT_PATH</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">FileUtil</span><span class="p">.</span><span class="nf">ReplaceFile</span><span class="p">(</span><span class="n">PRE_COMMIT_PATH</span><span class="p">,</span> <span class="n">PRE_COMMIT_BAK_PATH</span><span class="p">);</span>
                    <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Previous pre-commit hook found. Backup created."</span><span class="p">);</span>
                <span class="p">}</span>
                
                <span class="n">FileUtil</span><span class="p">.</span><span class="nf">ReplaceFile</span><span class="p">(</span><span class="n">PRE_COMMIT_TEMPLATE_PATH</span><span class="p">,</span> <span class="n">PRE_COMMIT_PATH</span><span class="p">);</span>
                <span class="n">EditorPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">,</span> <span class="n">PRE_COMMIT_VERSION</span><span class="p">);</span>
                
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Successfully registered git pre-commit hook"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Fail to register git pre-commit hook with error: </span><span class="p">{</span><span class="n">e</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="p">[</span><span class="nf">MenuItem</span><span class="p">(</span><span class="s">"Tools/Git/Pre-commit/Disable till next run"</span><span class="p">)]</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">DisablePreCommitHook</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">FileUtil</span><span class="p">.</span><span class="nf">DeleteFileOrDirectory</span><span class="p">(</span><span class="n">PRE_COMMIT_PATH</span><span class="p">);</span>
                <span class="n">EditorPrefs</span><span class="p">.</span><span class="nf">SetInt</span><span class="p">(</span><span class="n">PRE_COMMIT_PREF_KEY</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
                
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Disabled git pre-commit hook until next run"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">$"Fail to disable git pre-commit hook with error: </span><span class="p">{</span><span class="n">e</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">//---------------------------------------------------------------------</span>
        <span class="c1">// Helpers</span>
        <span class="c1">//---------------------------------------------------------------------</span>

        <span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">Base64Encode</span><span class="p">(</span><span class="kt">string</span> <span class="n">plainText</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">plainTextBytes</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">plainText</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToBase64String</span><span class="p">(</span><span class="n">plainTextBytes</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="conclusion"><span class="me-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>We’re only human. We make typos, forget to turn off the stove, and sometimes accidentally mess up our project settings. That’s why adding a bit of magic to our workflow is awesome. The magic of Git hooks, those tiny, vigilant elves living in your <code class="language-plaintext filepath highlighter-rouge">.git</code> folder, and always ready to shout “Stop!” to prevent bad commits! And for an extra sprinkle of awesomeness, we’ve got our Unity editor script automating the process for the whole team.</p>

<p>There are many more use cases for Git hooks and how to make useful Unity integrations. But I hope this article will help you to get started. And if you have any questions or suggestions, feel free to leave a comment below (when I’ll finally make them work…).</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/unity/">Unity</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/unity/"
            class="post-tag no-text-decoration"
          >unity</a>
        
          <a
            href="/tags/git/"
            class="post-tag no-text-decoration"
          >git</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Unity%20and%20convenience%20of%20Git%20hooks%20-%20Borodar's%20Blog&url=https%3A%2F%2Fblog.borodar.com%2Fposts%2Funity_git_hooks%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Unity%20and%20convenience%20of%20Git%20hooks%20-%20Borodar's%20Blog&u=https%3A%2F%2Fblog.borodar.com%2Fposts%2Funity_git_hooks%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.borodar.com%2Fposts%2Funity_git_hooks%2F&text=Unity%20and%20convenience%20of%20Git%20hooks%20-%20Borodar's%20Blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/unity_git_hooks/">Unity and convenience of Git hooks</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/welcome_aboard/">Welcome Aboard!</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/unity/">unity</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  
    











            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/welcome_aboard/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Welcome Aboard!</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2024</time>
    <a href="https://www.borodar.com">Borodar</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/git/">git</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/jekyll/">jekyll</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/unity/">unity</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

